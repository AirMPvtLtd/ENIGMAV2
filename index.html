<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Drone Math Master | STEM Learning Platform</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #0066cc;
      --primary-dark: #004d99;
      --primary-light: #e6f2ff;
      --secondary: #00a86b;
      --secondary-dark: #008055;
      --accent: #ff6b35;
      --dark: #2d3748;
      --light: #f8f9fa;
      --gray: #6c757d;
      --success: #28a745;
      --warning: #fd7e14;
      --danger: #dc3545;
      --border-radius: 8px;
      --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }
    
    body {
      background: #f5f7fa;
      color: var(--dark);
      font-family: 'Roboto', sans-serif;
      line-height: 1.6;
      padding: 0;
      margin: 0;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 20px 0;
      box-shadow: var(--box-shadow);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .logo-icon {
      font-size: 32px;
    }
    
    .logo-text h1 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 24px;
      margin: 0;
    }
    
    .logo-text p {
      font-size: 14px;
      opacity: 0.9;
      margin: 0;
    }
    
    .user-controls {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .btn {
      display: inline-block;
      padding: 10px 20px;
      border-radius: var(--border-radius);
      font-weight: 500;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      border: none;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    .btn-outline {
      background-color: transparent;
      border: 2px solid white;
      color: white;
    }
    
    .btn-outline:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    main {
      padding: 30px 0;
    }
    
    .dashboard {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: 30px;
    }
    
    .sidebar {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      height: fit-content;
    }
    
    .sidebar-section {
      margin-bottom: 25px;
    }
    
    .sidebar-section h3 {
      font-size: 16px;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }
    
    .sidebar-menu {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .sidebar-menu li {
      margin-bottom: 8px;
    }
    
    .sidebar-menu a {
      display: block;
      padding: 8px 10px;
      color: var(--dark);
      text-decoration: none;
      border-radius: 4px;
      transition: var(--transition);
    }
    
    .sidebar-menu a:hover, .sidebar-menu a.active {
      background-color: var(--primary-light);
      color: var(--primary);
    }
    
    .sidebar-menu a i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    .content-area {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }
    
    .card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 25px;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .card-header h2 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      font-size: 20px;
      margin: 0;
      color: var(--primary);
    }
    
    .card-header .actions {
      display: flex;
      gap: 10px;
    }
    
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
    }
    
    .control-group label {
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--gray);
      font-size: 14px;
    }
    
    select, input, textarea {
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-family: 'Roboto', sans-serif;
      transition: var(--transition);
    }
    
    select:focus, input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.2);
    }
    
    .flight-visualization {
      position: relative;
    }
    
    canvas {
      width: 100%;
      height: 400px;
      border-radius: var(--border-radius);
      background: white;
      border: 1px solid #eee;
      display: block;
    }
    
    .equation-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }
    
    .equation-btn {
      background-color: var(--secondary);
      color: white;
      padding: 10px 20px;
      border-radius: 30px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      border: none;
    }
    
    .equation-btn:hover {
      background-color: var(--secondary-dark);
      transform: translateY(-2px);
    }
    
    .equation-btn.active {
      background-color: var(--primary);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 25px;
    }
    
    .info-card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      border-top: 4px solid var(--primary);
      transition: var(--transition);
    }
    
    .info-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }
    
    .info-card h4 {
      font-family: 'Montserrat', sans-serif;
      color: var(--primary);
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .info-card h4 i {
      font-size: 20px;
    }
    
    .info-card p {
      color: var(--gray);
      margin: 0;
      font-size: 14px;
    }
    
    .learning-section {
      margin-top: 30px;
    }
    
    .problem-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 25px;
      margin-bottom: 20px;
    }
    
    .problem-container h3 {
      font-family: 'Montserrat', sans-serif;
      color: var(--primary);
      margin-top: 0;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .problem-container h3 i {
      color: var(--accent);
    }
    
    .problem-content {
      background: var(--primary-light);
      padding: 20px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
    }
    
    .answer-input {
      margin-bottom: 20px;
    }
    
    .answer-input textarea {
      width: 100%;
      min-height: 100px;
      padding: 15px;
      border-radius: var(--border-radius);
      border: 1px solid #ddd;
      font-family: 'Roboto', sans-serif;
      resize: vertical;
    }
    
    .feedback-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 25px;
    }
    
    .feedback-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .feedback-header h3 {
      font-family: 'Montserrat', sans-serif;
      color: var(--primary);
      margin: 0;
    }
    
    .feedback-content {
      padding: 15px;
      border-radius: var(--border-radius);
    }
    
    .feedback-correct {
      background: rgba(40, 167, 69, 0.1);
      border-left: 4px solid var(--success);
    }
    
    .feedback-incorrect {
      background: rgba(220, 53, 69, 0.1);
      border-left: 4px solid var(--danger);
    }
    
    .progress-container {
      margin-top: 30px;
    }
    
    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .progress-header h4 {
      margin: 0;
      color: var(--gray);
      font-size: 14px;
    }
    
    .progress-bar {
      height: 10px;
      background: #eee;
      border-radius: 5px;
      overflow: hidden;
      margin-bottom: 5px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--secondary), var(--success));
      width: 0%;
      transition: width 0.5s ease;
    }
    
    .progress-stats {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--gray);
    }
    
    .segment {
      position: absolute;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }
    
    .segment-distance {
      position: absolute;
      background: rgba(255, 255, 255, 0.9);
      padding: 5px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 500;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }
    
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      background: var(--primary-light);
      color: var(--primary);
    }
    
    .badge-success {
      background: rgba(40, 167, 69, 0.1);
      color: var(--success);
    }
    
    .badge-warning {
      background: rgba(253, 126, 20, 0.1);
      color: var(--warning);
    }
    
    .badge-danger {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger);
    }
    
    footer {
      background: var(--dark);
      color: white;
      padding: 30px 0;
      margin-top: 50px;
    }
    
    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
    }
    
    .footer-column h4 {
      font-family: 'Montserrat', sans-serif;
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 16px;
    }
    
    .footer-column ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .footer-column ul li {
      margin-bottom: 8px;
    }
    
    .footer-column ul li a {
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      transition: var(--transition);
      font-size: 14px;
    }
    
    .footer-column ul li a:hover {
      color: white;
    }
    
    .copyright {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.5);
      font-size: 13px;
    }
    
    @media (max-width: 768px) {
      .dashboard {
        grid-template-columns: 1fr;
      }
      
      .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .user-controls {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-drone-alt"></i>
          </div>
          <div class="logo-text">
            <h1>Drone Math Master</h1>
            <p>STEM Learning Platform for Future Aviators</p>
          </div>
        </div>
        <div class="user-controls">
          <button class="btn btn-outline"><i class="fas fa-user-graduate"></i> Student Dashboard</button>
          <button class="btn btn-primary"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
      </div>
    </div>
  </header>
  
  <main class="container">
    <div class="dashboard">
      <aside class="sidebar">
        <div class="sidebar-section">
          <h3>Navigation</h3>
          <ul class="sidebar-menu">
            <li><a href="#" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="#"><i class="fas fa-chart-line"></i> Progress Analytics</a></li>
            <li><a href="#"><i class="fas fa-book"></i> Learning Modules</a></li>
            <li><a href="#"><i class="fas fa-trophy"></i> Achievements</a></li>
            <li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
          </ul>
        </div>
        
        <div class="sidebar-section">
          <h3>Recent Flights</h3>
          <ul class="sidebar-menu">
            <li><a href="#"><i class="fas fa-map-marked-alt"></i> July 23, 2024</a></li>
            <li><a href="#"><i class="fas fa-map-marked-alt"></i> DR-2456</a></li>
            <li><a href="#"><i class="fas fa-map-marked-alt"></i> DR-2455</a></li>
          </ul>
        </div>
        
        <div class="sidebar-section">
          <h3>Quick Access</h3>
          <ul class="sidebar-menu">
            <li><a href="#"><i class="fas fa-question-circle"></i> Help Center</a></li>
            <li><a href="#"><i class="fas fa-file-alt"></i> Documentation</a></li>
            <li><a href="#"><i class="fas fa-video"></i> Tutorial Videos</a></li>
          </ul>
        </div>
      </aside>
      
      <div class="content-area">
        <div class="card">
          <div class="card-header">
            <h2><i class="fas fa-map-marked-alt"></i> Flight Path Analysis</h2>
            <div class="actions">
              <button class="btn btn-primary"><i class="fas fa-download"></i> Export Data</button>
              <button class="btn btn-primary"><i class="fas fa-share-alt"></i> Share</button>
            </div>
          </div>
          
          <div class="controls">
            <div class="control-group">
              <label for="classSelect"><i class="fas fa-graduation-cap"></i> Grade Level</label>
              <select id="classSelect" onchange="loadEquations()">
                <option value="">-- Select Grade --</option>
                <option value="6">Grade 6</option>
                <option value="7">Grade 7</option>
                <option value="8">Grade 8</option>
                <option value="9">Grade 9</option>
                <option value="10">Grade 10</option>
                <option value="11">Grade 11</option>
                <option value="12">Grade 12</option>
              </select>
            </div>
            
            <div class="control-group">
              <label for="flightSelect"><i class="fas fa-drone"></i> Flight Session</label>
              <select id="flightSelect">
                <option value="1">Last Flight (July 23, 2024)</option>
                <option value="2">Flight #DR-2456</option>
                <option value="3">Flight #DR-2455</option>
              </select>
            </div>
            
            <div class="control-group">
              <label for="analysisType"><i class="fas fa-chart-pie"></i> Analysis Type</label>
              <select id="analysisType">
                <option value="basic">Basic Geometry</option>
                <option value="advanced">Advanced Calculations</option>
                <option value="performance">Performance Metrics</option>
              </select>
            </div>
          </div>
          
          <div class="flight-visualization">
            <canvas id="flightCanvas" width="800" height="400"></canvas>
          </div>
          
          <div class="equation-list" id="equationList"></div>
          
          <div class="info-grid" id="equationInfo">
            <div class="info-card">
              <h4><i class="fas fa-history"></i> Historical Context</h4>
              <p id="origin">Select an equation to learn about its historical development and significance in mathematics.</p>
            </div>
            
            <div class="info-card">
              <h4><i class="fas fa-rocket"></i> Modern Applications</h4>
              <p id="modernUse">Discover how this mathematical concept is applied in modern technology, especially in drone aviation.</p>
            </div>
            
            <div class="info-card">
              <h4><i class="fas fa-drone"></i> Drone Technology</h4>
              <p id="droneImpact">Learn how this equation impacts drone flight paths, navigation, and performance optimization.</p>
            </div>
            
            <div class="info-card">
              <h4><i class="fas fa-code"></i> Programming</h4>
              <p id="coding">See practical examples of how to implement this mathematical concept in programming code.</p>
            </div>
          </div>
        </div>
        
        <div class="learning-section">
          <div class="problem-container">
            <h3><i class="fas fa-puzzle-piece"></i> Learning Challenge</h3>
            <div class="problem-content" id="problemArea">
              <p>Select an equation from above to receive a customized problem based on the current flight path analysis.</p>
            </div>
            
            <div class="answer-input">
              <textarea id="studentAnswer" placeholder="Type your solution here... Be sure to show your work and explain your reasoning."></textarea>
              <button class="btn btn-primary" onclick="checkAnswer()"><i class="fas fa-paper-plane"></i> Submit Answer</button>
            </div>
          </div>
          
          <div class="feedback-container" id="feedbackContainer" style="display: none;">
            <div class="feedback-header">
              <h3><i class="fas fa-comment-dots"></i> Feedback</h3>
              <span class="badge" id="feedbackBadge">New</span>
            </div>
            <div class="feedback-content" id="feedbackArea"></div>
          </div>
          
          <div class="progress-container">
            <div class="progress-header">
              <h4><i class="fas fa-trophy"></i> Mastery Progress</h4>
              <span id="masteryPercent">0%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="masteryProgress"></div>
            </div>
            <div class="progress-stats">
              <span id="attemptsCount">Attempts: 0</span>
              <span id="timeSpent">Time: 0s</span>
              <span id="accuracyRate">Accuracy: 0%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-column">
          <h4>Drone Math Master</h4>
          <ul>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Our Mission</a></li>
            <li><a href="#">Team</a></li>
            <li><a href="#">Careers</a></li>
          </ul>
        </div>
        
        <div class="footer-column">
          <h4>Resources</h4>
          <ul>
            <li><a href="#">Documentation</a></li>
            <li><a href="#">Tutorials</a></li>
            <li><a href="#">API Reference</a></li>
            <li><a href="#">Research Papers</a></li>
          </ul>
        </div>
        
        <div class="footer-column">
          <h4>Support</h4>
          <ul>
            <li><a href="#">Help Center</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Feedback</a></li>
            <li><a href="#">System Status</a></li>
          </ul>
        </div>
        
        <div class="footer-column">
          <h4>Connect</h4>
          <ul>
            <li><a href="#"><i class="fab fa-twitter"></i> Twitter</a></li>
            <li><a href="#"><i class="fab fa-linkedin"></i> LinkedIn</a></li>
            <li><a href="#"><i class="fab fa-github"></i> GitHub</a></li>
            <li><a href="#"><i class="fab fa-youtube"></i> YouTube</a></li>
          </ul>
        </div>
      </div>
      
      <div class="copyright">
        &copy; 2024 Drone Math Master. All rights reserved. | STEM Education Platform
      </div>
    </div>
  </footer>

  <script>
    const canvas = document.getElementById("flightCanvas");
    const ctx = canvas.getContext("2d");
    let currentEquation = null;
    let studentAttempts = 0;
    let startTime = null;
    let masteryLevel = 0;
    let correctAnswers = 0;

    // Flight path data with additional metadata
    const flightPaths = {
      1: {
        points: [
          [50, 350], [150, 300], [200, 200], [300, 250], [350, 350], 
          [450, 300], [500, 200], [600, 250], [700, 350], [750, 300]
        ],
        date: "2024-07-23",
        duration: "12:34",
        altitude: "120m",
        distance: "2.4km"
      },
      2: {
        points: [
          [50, 200], [150, 250], [250, 150], [350, 200], [450, 100],
          [550, 150], [650, 200], [750, 150]
        ],
        date: "2024-07-21",
        duration: "08:12",
        altitude: "85m",
        distance: "1.8km"
      },
      3: {
        points: [
          [50, 300], [200, 250], [350, 300], [500, 250], [650, 300], [750, 250]
        ],
        date: "2024-07-18",
        duration: "06:45",
        altitude: "95m",
        distance: "1.5km"
      }
    };

    // Enhanced equations by grade level with categories
    const equationsByClass = {
      6: {
        "Geometry": ["Perimeter of Rectangle", "Area of Square", "Circumference of Circle"],
        "Arithmetic": ["Simple Interest", "Average Speed", "Percentage Calculations"],
        "Measurement": ["Unit Conversions", "Time Calculations"]
      },
      7: {
        "Geometry": ["Pythagoras Theorem", "Area of Triangle", "Volume of Cube"],
        "Algebra": ["Linear Equations", "Ratio and Proportion"],
        "Statistics": ["Mean, Median, Mode", "Probability Basics"]
      },
      8: {
        "Algebra": ["Algebraic Expressions", "Linear Equations", "Quadratic Equations"],
        "Geometry": ["Volume of Cuboid", "Surface Area", "Angle Properties"],
        "Financial": ["Compound Interest", "Profit/Loss"]
      },
      9: {
        "Geometry": ["Quadratic Equations", "Heron's Formula", "Distance Formula"],
        "Trigonometry": ["Trigonometric Ratios", "Pythagorean Theorem"],
        "Coordinate": ["Slope of Line", "Distance Between Points"]
      },
      10: {
        "Trigonometry": ["Trigonometric Identities", "Heights and Distances"],
        "Algebra": ["Arithmetic Progression", "Quadratic Formula"],
        "Geometry": ["Circle Theorems", "Constructions"]
      },
      11: {
        "Calculus": ["Calculus Basics", "Derivatives", "Limits"],
        "Algebra": ["Binomial Theorem", "Permutations"],
        "Geometry": ["Straight Lines", "Conic Sections"]
      },
      12: {
        "Calculus": ["Derivatives", "Integrals", "Differential Equations"],
        "Vectors": ["Vector Algebra", "3D Geometry"],
        "Probability": ["Probability Distributions", "Matrices"]
      }
    };

    // Initialize the application
    function init() {
      drawFlightPath(1);
      document.getElementById("flightSelect").addEventListener("change", function() {
        drawFlightPath(this.value);
      });
      
      // Set up responsive canvas
      setupResponsiveCanvas();
      window.addEventListener('resize', setupResponsiveCanvas);
    }
    
    // Make canvas responsive
    function setupResponsiveCanvas() {
      const container = document.querySelector('.flight-visualization');
      canvas.width = container.offsetWidth;
      canvas.height = 400;
      const currentFlight = document.getElementById("flightSelect").value;
      if (currentFlight) drawFlightPath(currentFlight);
    }

    // Draw flight path with enhanced visualization
    function drawFlightPath(flightId) {
      const flight = flightPaths[flightId];
      const path = flight.points;
      
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw grid
      drawGrid();
      
      // Draw flight path
      ctx.strokeStyle = "#0066cc";
      ctx.lineWidth = 3;
      ctx.fillStyle = "rgba(0, 102, 204, 0.1)";
      
      // Draw path
      ctx.beginPath();
      ctx.moveTo(path[0][0], path[0][1]);
      for (let i = 1; i < path.length; i++) {
        ctx.lineTo(path[i][0], path[i][1]);
      }
      ctx.stroke();
      
      // Draw points with enhanced styling
      for (let i = 0; i < path.length; i++) {
        // Point halo
        ctx.fillStyle = 'rgba(0, 102, 204, 0.2)';
        ctx.beginPath();
        ctx.arc(path[i][0], path[i][1], 8, 0, Math.PI * 2);
        ctx.fill();
        
        // Point center
        ctx.fillStyle = '#0066cc';
        ctx.beginPath();
        ctx.arc(path[i][0], path[i][1], 5, 0, Math.PI * 2);
        ctx.fill();
        
        // Point label
        ctx.fillStyle = '#2d3748';
        ctx.font = 'bold 12px Roboto';
        ctx.fillText(`P${i+1}`, path[i][0] + 12, path[i][1] - 12);
        
        // Coordinates
        ctx.fillStyle = '#6c757d';
        ctx.font = '10px Roboto';
        ctx.fillText(`(${path[i][0]},${path[i][1]})`, path[i][0] + 12, path[i][1] + 5);
      }
      
      // Segment and label the path
      segmentAndLabelPath(path);
      
      // Update flight info
      updateFlightInfo(flight);
    }
    
    // Draw grid for the canvas
    function drawGrid() {
      ctx.strokeStyle = "#eee";
      ctx.lineWidth = 1;
      
      // Vertical lines
      for (let x = 0; x <= canvas.width; x += 50) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
        
        // X-axis labels
        if (x > 0 && x < canvas.width) {
          ctx.fillStyle = '#6c757d';
          ctx.font = '10px Roboto';
          ctx.fillText(x, x - 10, canvas.height - 5);
        }
      }
      
      // Horizontal lines
      for (let y = 0; y <= canvas.height; y += 50) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
        
        // Y-axis labels (inverted because canvas Y increases downward)
        if (y > 0 && y < canvas.height) {
          ctx.fillStyle = '#6c757d';
          ctx.font = '10px Roboto';
          ctx.fillText(canvas.height - y, 5, y - 5);
        }
      }
    }
    
    // Update flight information display
    function updateFlightInfo(flight) {
      // In a real app, this would update a flight info panel
      console.log(`Displaying flight from ${flight.date} - Duration: ${flight.duration}, Altitude: ${flight.altitude}, Distance: ${flight.distance}`);
    }

    // Segment the path into geometric shapes and label them
    function segmentAndLabelPath(path) {
      // Clear previous segments
      document.querySelectorAll('.segment, .segment-distance').forEach(el => el.remove());
      
      // Define segments with enhanced styling
      const segments = [
        {
          type: "Right Triangle", 
          points: [0, 1, 2], 
          color: "#ff6b35",
          properties: {
            "Base": calculateDistance(path[0], path[2]),
            "Height": calculateDistance(path[2], path[1]),
            "Hypotenuse": calculateDistance(path[0], path[1])
          }
        },
        {
          type: "Quadrilateral", 
          points: [2, 3, 4, 5], 
          color: "#00a86b",
          properties: {
            "Side A": calculateDistance(path[2], path[3]),
            "Side B": calculateDistance(path[3], path[4]),
            "Side C": calculateDistance(path[4], path[5]),
            "Side D": calculateDistance(path[5], path[2])
          }
        },
        {
          type: "Trapezoid", 
          points: [5, 6, 7, 8], 
          color: "#9c27b0",
          properties: {
            "Parallel Side 1": calculateDistance(path[5], path[8]),
            "Parallel Side 2": calculateDistance(path[6], path[7]),
            "Leg 1": calculateDistance(path[5], path[6]),
            "Leg 2": calculateDistance(path[7], path[8])
          }
        },
        {
          type: "Line Segment", 
          points: [8, 9], 
          color: "#2196f3",
          properties: {
            "Length": calculateDistance(path[8], path[9])
          }
        }
      ];
      
      segments.forEach(seg => {
        // Draw segment with fill for closed shapes
        ctx.strokeStyle = seg.color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(path[seg.points[0]][0], path[seg.points[0]][1]);
        
        for (let i = 1; i < seg.points.length; i++) {
          ctx.lineTo(path[seg.points[i]][0], path[seg.points[i]][1]);
        }
        
        if (seg.points.length > 2) {
          ctx.closePath();
          ctx.fillStyle = `${seg.color}20`; // Add transparency
          ctx.fill();
        }
        
        ctx.stroke();
        
        // Calculate center for label
        let xSum = 0, ySum = 0;
        seg.points.forEach(idx => {
          xSum += path[idx][0];
          ySum += path[idx][1];
        });
        const centerX = xSum / seg.points.length;
        const centerY = ySum / seg.points.length;
        
        // Create segment label
        const label = document.createElement('div');
        label.className = 'segment';
        label.textContent = seg.type;
        label.style.color = seg.color;
        label.style.border = `1px solid ${seg.color}`;
        label.style.left = `${centerX + canvas.getBoundingClientRect().left}px`;
        label.style.top = `${centerY + canvas.getBoundingClientRect().top}px`;
        document.body.appendChild(label);
        
        // Add distance labels for each side
        if (seg.type === "Line Segment") {
          const p1 = path[seg.points[0]];
          const p2 = path[seg.points[1]];
          
          const distLabel = document.createElement('div');
          distLabel.className = 'segment-distance';
          distLabel.textContent = `${seg.properties.Length.toFixed(1)}px`;
          distLabel.style.color = seg.color;
          distLabel.style.left = `${(p1[0]+p2[0])/2 + canvas.getBoundingClientRect().left}px`;
          distLabel.style.top = `${(p1[1]+p2[1])/2 + canvas.getBoundingClientRect().top}px`;
          document.body.appendChild(distLabel);
        } else {
          // For shapes with multiple sides
          seg.points.forEach((pointIdx, i) => {
            const nextIdx = seg.points[(i + 1) % seg.points.length];
            const p1 = path[pointIdx];
            const p2 = path[nextIdx];
            
            const sideName = Object.keys(seg.properties)[i];
            const distLabel = document.createElement('div');
            distLabel.className = 'segment-distance';
            distLabel.textContent = `${sideName}: ${seg.properties[sideName].toFixed(1)}px`;
            distLabel.style.color = seg.color;
            distLabel.style.left = `${(p1[0]+p2[0])/2 + canvas.getBoundingClientRect().left}px`;
            distLabel.style.top = `${(p1[1]+p2[1])/2 + canvas.getBoundingClientRect().top}px`;
            document.body.appendChild(distLabel);
          });
        }
      });
    }
    
    // Calculate distance between two points
    function calculateDistance(p1, p2) {
      return Math.sqrt(Math.pow(p2[0]-p1[0], 2) + Math.pow(p2[1]-p1[1], 2));
    }

    // Load equations for selected class with categories
    function loadEquations() {
      const classSelect = document.getElementById("classSelect");
      const equationList = document.getElementById("equationList");
      equationList.innerHTML = '';
      
      if (!classSelect.value) return;
      
      const gradeEquations = equationsByClass[classSelect.value];
      
      // Create category sections
      for (const category in gradeEquations) {
        const categoryHeader = document.createElement('h4');
        categoryHeader.textContent = category;
        categoryHeader.style.margin = '15px 0 5px 0';
        categoryHeader.style.color = '#0066cc';
        equationList.appendChild(categoryHeader);
        
        const categoryContainer = document.createElement('div');
        categoryContainer.style.display = 'flex';
        categoryContainer.style.flexWrap = 'wrap';
        categoryContainer.style.gap = '10px';
        categoryContainer.style.marginBottom = '15px';
        
        gradeEquations[category].forEach(eq => {
          const btn = document.createElement("button");
          btn.className = "equation-btn";
          btn.innerText = eq;
          btn.onclick = () => selectEquation(eq, category);
          categoryContainer.appendChild(btn);
        });
        
        equationList.appendChild(categoryContainer);
      }
    }

    // When equation is selected
    async function selectEquation(equation, category) {
      // Update UI
      document.querySelectorAll('.equation-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      currentEquation = equation;
      studentAttempts = 0;
      correctAnswers = 0;
      masteryLevel = 0;
      startTime = new Date();
      updateProgressUI();
      
      // Get equation info from AI
      await getEquationInfo(equation, category);
      
      // Generate a problem
      generateProblem(equation, category);
      
      // Show the feedback container (hidden initially)
      document.getElementById("feedbackContainer").style.display = 'block';
    }

    // Get equation information from AI
    async function getEquationInfo(equation, category) {
      // Show loading state
      document.getElementById("origin").innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Loading historical context...</p>';
      document.getElementById("modernUse").innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Loading modern applications...</p>';
      document.getElementById("droneImpact").innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Loading drone applications...</p>';
      document.getElementById("coding").innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Loading code examples...</p>';
      
      const API_KEY = 'TS5JcIJJLlaCMq2S2xoYe2ELjStoqtbV'; // Replace with your actual key
      const API_URL = 'https://api.mistral.ai/v1/chat/completions';
      
      const prompt = `As a math and drone expert, provide detailed information about "${equation}" (category: ${category}) in this exact format:
      
1. **Historical Context**: [Provide 1-2 paragraphs about the origin and historical development of this mathematical concept. Mention key mathematicians involved and the historical problems it solved.]

2. **Modern Applications**: [Explain current uses of this concept in technology and engineering, with emphasis on drone technology. Provide specific examples.]

3. **Drone Relevance**: [Detail exactly how this mathematical concept is used in drone navigation, flight planning, or performance optimization. Include real-world examples.]

4. **Implementation**: [Show how to implement this concept in code (JavaScript preferred). Provide a clear example with explanation. Format code with Markdown.]`;
      
      try {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model: "mistral-medium",
            messages: [
              { role: "system", content: prompt }
            ],
            temperature: 0.5,
            max_tokens: 2000
          })
        });

        const data = await response.json();
        const result = data.choices?.[0]?.message?.content || "No response from AI.";
        
        // Parse the response (this is simplified - you might need more robust parsing)
        try {
          const historicalMatch = result.match(/1\. \*\*Historical Context\*\*:([\s\S]*?)2\. \*\*Modern Applications\*\*/);
          const modernMatch = result.match(/2\. \*\*Modern Applications\*\*:([\s\S]*?)3\. \*\*Drone Relevance\*\*/);
          const droneMatch = result.match(/3\. \*\*Drone Relevance\*\*:([\s\S]*?)4\. \*\*Implementation\*\*/);
          const codeMatch = result.match(/4\. \*\*Implementation\*\*:([\s\S]*)/);
          
          if (historicalMatch) document.getElementById("origin").innerHTML = `<p>${historicalMatch[1].trim()}</p>`;
          if (modernMatch) document.getElementById("modernUse").innerHTML = `<p>${modernMatch[1].trim()}</p>`;
          if (droneMatch) document.getElementById("droneImpact").innerHTML = `<p>${droneMatch[1].trim()}</p>`;
          if (codeMatch) document.getElementById("coding").innerHTML = `<pre>${codeMatch[1].trim()}</pre>`;
        } catch (e) {
          console.error("Error parsing AI response:", e);
          document.getElementById("origin").innerHTML = `<p>${result}</p>`;
        }
      } catch (error) {
        console.error("Error calling AI API:", error);
        document.getElementById("origin").innerHTML = '<p>Error loading information. Please try again.</p>';
      }
    }

    // Generate a problem based on the equation
    async function generateProblem(equation, category) {
      // Show loading state
      document.getElementById("problemArea").innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Generating problem...</p>';
      
      const API_KEY = 'TS5JcIJJLlaCMq2S2xoYe2ELjStoqtbV';
      const API_URL = 'https://api.mistral.ai/v1/chat/completions';
      
      const flightSelect = document.getElementById("flightSelect").value;
      const flightData = flightPaths[flightSelect];
      
      const prompt = `Create a realistic drone-related math problem for a high school student using ${equation} (category: ${category}). 
      
      Requirements:
      - Base the problem on this flight path data: ${JSON.stringify(flightData.points)}
      - The problem should require using ${equation} to solve
      - Make it relevant to drone navigation, performance, or flight planning
      - Include all necessary data points from the flight path
      - Make the problem challenging but solvable for a high school student
      - Format the problem clearly with all necessary information
      
      Provide just the problem statement, no solution or hints.`;
      
      try {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model: "mistral-medium",
            messages: [
              { role: "system", content: prompt }
            ],
            temperature: 0.7,
            max_tokens: 500
          })
        });

        const data = await response.json();
        const problem = data.choices?.[0]?.message?.content || "Could not generate problem. Please try again.";
        document.getElementById("problemArea").innerHTML = `
          <h4>Problem Statement</h4>
          <div class="problem-statement">
            <p>${problem}</p>
          </div>
        `;
        document.getElementById("feedbackArea").innerHTML = "";
        document.getElementById("studentAnswer").value = "";
        document.getElementById("feedbackBadge").className = "badge";
        document.getElementById("feedbackBadge").textContent = "New Problem";
      } catch (error) {
        console.error("Error generating problem:", error);
        document.getElementById("problemArea").innerHTML = '<p>Error generating problem. Please try again.</p>';
      }
    }

    // Check student's answer
    async function checkAnswer() {
      const answer = document.getElementById("studentAnswer").value.trim();
      if (!answer || !currentEquation) return;
      
      studentAttempts++;
      const timeTaken = Math.floor((new Date() - startTime) / 1000); // in seconds
      
      // Show checking state
      document.getElementById("feedbackArea").innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Evaluating your answer...</p>';
      document.getElementById("feedbackBadge").className = "badge";
      document.getElementById("feedbackBadge").textContent = "Checking";
      
      const API_KEY = 'TS5JcIJJLlaCMq2S2xoYe2ELjStoqtbV';
      const API_URL = 'https://api.mistral.ai/v1/chat/completions';
      
      const prompt = `Evaluate this student answer for the math problem about "${currentEquation}":
      
      Student Answer: ${answer}
      
      Provide detailed feedback considering:
      1. Correctness: Is the answer mathematically correct? If not, what's the error?
      2. Explanation: Provide a step-by-step solution with clear reasoning
      3. Improvement: Suggest how the student could improve their approach
      4. Mastery: Estimate mastery level (0-100) based on answer quality
      
      Format your response exactly like this:
      
      Correct: [Yes/No]
      Feedback: [Your detailed feedback here]
      Mastery: [0-100]`;
      
      try {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model: "mistral-medium",
            messages: [
              { role: "system", content: prompt }
            ],
            temperature: 0.3,
            max_tokens: 1000
          })
        });

        const data = await response.json();
        const result = data.choices?.[0]?.message?.content || "Could not evaluate answer.";
        
        // Parse the response
        const isCorrect = result.includes("Correct: Yes");
        let feedback = "Could not parse feedback.";
        let newMastery = masteryLevel;
        
        if (result.includes("Feedback:")) {
          feedback = result.split("Feedback:")[1].split("Mastery:")[0].trim();
        } else {
          feedback = result;
        }
        
        if (result.includes("Mastery:")) {
          const masteryText = result.split("Mastery:")[1].trim();
          const masteryMatch = masteryText.match(/\d+/);
          newMastery = masteryMatch ? parseInt(masteryMatch[0]) : masteryLevel;
        }
        
        if (isCorrect) correctAnswers++;
        masteryLevel = newMastery;
        
        // Update UI
        updateProgressUI();
        
        document.getElementById("feedbackArea").innerHTML = `
          <div class="${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}">
            <h4>${isCorrect ? '✅ Correct Answer!' : '❌ Needs Improvement'}</h4>
            <p>${feedback}</p>
            ${!isCorrect ? `
              <button class="btn btn-primary" onclick="generateProblem(currentEquation)">
                <i class="fas fa-redo"></i> Try Another Problem
              </button>
            ` : ''}
          </div>
        `;
        
        document.getElementById("feedbackBadge").className = isCorrect ? "badge badge-success" : "badge badge-danger";
        document.getElementById("feedbackBadge").textContent = isCorrect ? "Correct" : "Incorrect";
        
        // Show coding implementation if mastery is high
        if (masteryLevel >= 80) {
          document.getElementById("feedbackArea").innerHTML += `
            <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 5px;">
              <h4><i class="fas fa-code"></i> Coding Implementation</h4>
              <p>Now that you've mastered the concept, here's how to implement it in code:</p>
              ${document.getElementById("coding").innerHTML}
              <button class="btn btn-primary" style="margin-top: 10px;">
                <i class="fas fa-laptop-code"></i> Try in Code Editor
              </button>
            </div>
          `;
        }
      } catch (error) {
        console.error("Error evaluating answer:", error);
        document.getElementById("feedbackArea").innerHTML = '<p>Error evaluating answer. Please try again.</p>';
        document.getElementById("feedbackBadge").className = "badge badge-warning";
        document.getElementById("feedbackBadge").textContent = "Error";
      }
    }

    // Update all progress indicators
    function updateProgressUI() {
      // Mastery progress bar
      document.getElementById("masteryProgress").style.width = `${masteryLevel}%`;
      document.getElementById("masteryPercent").textContent = `${masteryLevel}%`;
      
      // Attempts count
      document.getElementById("attemptsCount").textContent = `Attempts: ${studentAttempts}`;
      
      // Time spent
      const timeSpent = startTime ? Math.floor((new Date() - startTime) / 1000) : 0;
      document.getElementById("timeSpent").textContent = `Time: ${timeSpent}s`;
      
      // Accuracy rate
      const accuracy = studentAttempts > 0 ? Math.round((correctAnswers / studentAttempts) * 100) : 0;
      document.getElementById("accuracyRate").textContent = `Accuracy: ${accuracy}%`;
    }

    // Initialize the app
    window.onload = init;
  </script>
</body>
</html>
