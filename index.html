<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENIGMA STEM ENGINE | AIRM Learning Platform</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Exo+2:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include html2pdf for certificate generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #A855F7;
            --primary-dark: #7E22CE;
            --secondary: #3B82F6;
            --secondary-dark: #2563EB;
            --accent: #FF6B35;
            --dark: #0A0A0A;
            --light: #F8F9FA;
            --gray: #6C757D;
        }
        
        body {
            background-color: #0A0A0A;
            color: #FFFFFF;
            font-family: 'Exo 2', sans-serif;
            overflow-x: hidden;
            margin: 0;
        }
        
        .drone-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.7;
            z-index: -1;
        }
        
        .accent-button {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: transform 0.3s ease;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
        }
        
        .accent-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.5);
        }
        
        .section-heading {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
        }
        
        .content-section, .hero-section {
            background: transparent;
            position: relative;
            z-index: 1;
        }
        
        header {
            background: transparent;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .logo-svg {
            width: 150px;
            height: auto;
        }
        
        .info-vertical {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 40px;
        }
        
        .info-card {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 12px;
            padding: 25px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(168, 85, 247, 0.2);
            border-left: 4px solid var(--secondary);
        }
        
        .info-card h4 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-card h4 i {
            font-size: 20px;
            color: var(--secondary);
        }
        
        .info-card p {
            color: #D1D5DB;
            margin: 0;
            font-size: 14px;
            line-height: 1.6;
        }
        
        canvas {
            width: 100%;
            height: 400px;
            border-radius: 12px;
            background: rgba(20, 20, 20, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: block;
            backdrop-filter: blur(5px);
        }
        
        .equation-btn {
            background-color: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: 'Exo 2', sans-serif;
            margin: 5px;
        }
        
        .equation-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .equation-btn.active {
            background-color: var(--secondary);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }
        
        .problem-container {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .problem-container h3 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .problem-content {
            background: rgba(59, 130, 246, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--secondary);
        }
        
        .answer-input textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(30, 30, 30, 0.7);
            color: white;
            font-family: 'Exo 2', sans-serif;
            resize: vertical;
        }
        
        .feedback-container {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .feedback-correct {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28A745;
            padding: 15px;
            border-radius: 8px;
        }
        
        .feedback-incorrect {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid #DC3545;
            padding: 15px;
            border-radius: 8px;
        }
        
        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .nav-link {
            color: #D1D5DB;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Exo 2', sans-serif;
        }
        
        .nav-link:hover {
            color: var(--primary);
            background: rgba(168, 85, 247, 0.1);
        }
        
        .sidebar {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-menu a {
            color: #D1D5DB;
            transition: all 0.3s ease;
            font-family: 'Exo 2', sans-serif;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            color: var(--primary);
        }
        
        .certificate-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .certificate {
            background: white;
            width: 800px;
            max-width: 90%;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            position: relative;
            color: #333;
            font-family: 'Montserrat', sans-serif;
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.5);
            border: 10px solid #A855F7;
        }
        
        .certificate h2 {
            font-size: 28px;
            color: #3B82F6;
            margin-bottom: 10px;
        }
        
        .certificate h3 {
            font-size: 22px;
            color: #A855F7;
            margin-bottom: 30px;
        }
        
        .certificate p {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .certificate .signature {
            margin-top: 40px;
            display: flex;
            justify-content: space-around;
        }
        
        .competition-card {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--accent);
        }
        
        .competition-card h4 {
            font-family: 'Montserrat', sans-serif;
            color: var(--accent);
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .competition-card p {
            color: #D1D5DB;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .drone-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .control-btn {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.5);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }
        
        .control-btn i {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--secondary);
        }
        
        .connect-form {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .connect-form input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(30, 30, 30, 0.7);
            color: white;
            font-family: 'Exo 2', sans-serif;
            margin-bottom: 15px;
        }
        
        .language-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
        }
        
        .profile-form input, .profile-form select {
            width: 100%;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(30, 30, 30, 0.7);
            color: white;
            font-family: 'Exo 2', sans-serif;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .logo-svg {
                width: 100px;
            }
            
            .certificate {
                padding: 20px;
            }
            
            .certificate h2 {
                font-size: 22px;
            }
            
            .certificate h3 {
                font-size: 18px;
            }
            
            .certificate p {
                font-size: 16px;
            }
            
            .drone-controls {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Drone Swarm Canvas -->
    <canvas id="droneCanvas" class="drone-canvas"></canvas>

    <!-- Certificate Modal -->
    <div class="certificate-container" id="certificateContainer">
        <div class="certificate" id="certificate">
            <h2>CERTIFICATE OF MASTERY</h2>
            <h3>DRONE MATHEMATICS EXPERT</h3>
            <p>This is to certify that</p>
            <h4 id="studentName">[Student Name]</h4>
            <p>has successfully demonstrated mastery of</p>
            <h4 id="certificateEquation">[Mathematical Concept]</h4>
            <p>and its applications in drone technology</p>
            <div class="signature">
                <div>
                    <p>_________________________</p>
                    <p>Dr. Alex Johnson</p>
                    <p>Chief Learning Officer, ENIGMA STEM ENGINE</p>
                </div>
                <div>
                    <p>_________________________</p>
                    <p>Date: <span id="certificateDate"></span></p>
                </div>
            </div>
            <button class="accent-button mt-6" onclick="downloadCertificate()">
                <i class="fas fa-download mr-2"></i> Download Certificate
            </button>
            <button class="accent-button mt-4" onclick="closeCertificate()" style="background: #6c757d;">
                <i class="fas fa-times mr-2"></i> Close
            </button>
        </div>
    </div>

    <!-- Language Toggle Button -->
    <div class="language-toggle">
        <button id="languageToggle" class="accent-button" onclick="toggleLanguage()">
            <i class="fas fa-language mr-2"></i> हिंदी (Hindi)
        </button>
    </div>

    <!-- Header -->
    <header class="py-4">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <div class="text-2xl font-bold">
                <a href="/">
                    <svg class="logo-svg" viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg">
                        <!-- Cosmic orb with fiery glow -->
                        <defs>
                            <radialGradient id="orbGlow" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" style="stop-color:#FFFFFF;stop-opacity:0.8" />
                                <stop offset="70%" style="stop-color:#FF9500;stop-opacity:0.5" />
                                <stop offset="100%" style="stop-color:#0A0A0A;stop-opacity:0" />
                            </radialGradient>
                            <linearGradient id="textGlow" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#A855F7" />
                                <stop offset="100%" style="stop-color:#3B82F6" />
                            </linearGradient>
                        </defs>
                        <!-- Swirling orbit paths -->
                        <path d="M 30 30 A 20 20 0 0 1 50 50 A 20 20 0 0 1 30 30" fill="none" stroke="url(#orbGlow)" stroke-width="2" opacity="0.6">
                            <animateTransform attributeName="transform" type="rotate" from="0 30 30" to="360 30 30" dur="10s" repeatCount="indefinite" />
                        </path>
                        <path d="M 30 30 A 25 25 0 0 0 55 55 A 25 25 0 0 0 30 30" fill="none" stroke="url(#orbGlow)" stroke-width="1.5" opacity="0.5">
                            <animateTransform attributeName="transform" type="rotate" from="360 30 30" to="0 30 30" dur="12s" repeatCount="indefinite" />
                        </path>
                        <!-- Central orb -->
                        <circle cx="30" cy="30" r="15" fill="url(#orbGlow)" />
                        <!-- ENIGMA STEM ENGINE text -->
                        <text x="60" y="40" font-family="'Montserrat', sans-serif" font-size="20" font-weight="bold" fill="url(#textGlow)">ENIGMA STEM ENGINE</text>
                    </svg>
                </a>
            </div>
            <ul class="flex space-x-6">
                <li><a href="#home" class="nav-link">Home</a></li>
                <li><a href="#competitions" class="nav-link">Competitions</a></li>
                <li><a href="#pilot" class="nav-link">Piloting</a></li>
                <li><a href="#certificates" class="nav-link">Certificates</a></li>
                <li><a href="#connect" class="nav-link">Connect Drone</a></li>
            </ul>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Home Section -->
        <section id="home" class="content-section">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Sidebar -->
                <aside class="sidebar lg:col-span-1">
                    <div class="sidebar-section">
                        <h3 class="text-lg font-semibold mb-4 text-white border-b border-gray-700 pb-2">Navigation</h3>
                        <ul class="sidebar-menu">
                            <li><a href="#home" class="active flex items-center py-2"><i class="fas fa-home mr-3"></i> Home</a></li>
                            <li><a href="#profile" class="flex items-center py-2"><i class="fas fa-user mr-3"></i> My Profile</a></li>
                            <li><a href="#competitions" class="flex items-center py-2"><i class="fas fa-trophy mr-3"></i> Competitions</a></li>
                            <li><a href="#pilot" class="flex items-center py-2"><i class="fas fa-drone mr-3"></i> Piloting</a></li>
                            <li><a href="#certificates" class="flex items-center py-2"><i class="fas fa-certificate mr-3"></i> Certificates</a></li>
                            <li><a href="#connect" class="flex items-center py-2"><i class="fas fa-link mr-3"></i> Connect Drone</a></li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section mt-8">
                        <h3 class="text-lg font-semibold mb-4 text-white border-b border-gray-700 pb-2">Recent Flights</h3>
                        <ul class="sidebar-menu">
                            <li><a href="#" class="flex items-center py-2"><i class="fas fa-map-marked-alt mr-3"></i> July 23, 2024</a></li>
                            <li><a href="#" class="flex items-center py-2"><i class="fas fa-map-marked-alt mr-3"></i> DR-2456</a></li>
                            <li><a href="#" class="flex items-center py-2"><i class="fas fa-map-marked-alt mr-3"></i> DR-2455</a></li>
                        </ul>
                    </div>
                </aside>
                
                <!-- Main Content Area -->
                <div class="lg:col-span-3">
                    <div class="card mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold section-heading"><i class="fas fa-map-marked-alt mr-2"></i> Applied Invention Skills Program</h2>
                            <div class="flex space-x-3">
                                <button class="accent-button"><i class="fas fa-download mr-2"></i> Export Data</button>
                                <button class="accent-button"><i class="fas fa-share-alt mr-2"></i> Share</button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="control-group">
                                <label for="classSelect" class="block text-sm font-medium text-gray-300 mb-2"><i class="fas fa-graduation-cap mr-2"></i> Grade Level</label>
                                <select id="classSelect" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white">
                                    <option value="">-- Select Grade --</option>
                                    <option value="6">Grade 6</option>
                                    <option value="7">Grade 7</option>
                                    <option value="8">Grade 8</option>
                                    <option value="9">Grade 9</option>
                                    <option value="10">Grade 10</option>
                                    <option value="11">Grade 11</option>
                                    <option value="12">Grade 12</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label for="flightSelect" class="block text-sm font-medium text-gray-300 mb-2"><i class="fas fa-drone mr-2"></i> Flight Session</label>
                                <select id="flightSelect" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white">
                                    <option value="1">Last Flight (July 23, 2024)</option>
                                    <option value="2">Flight #DR-2456</option>
                                    <option value="3">Flight #DR-2455</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label for="analysisType" class="block text-sm font-medium text-gray-300 mb-2"><i class="fas fa-chart-pie mr-2"></i> Analysis Type</label>
                                <select id="analysisType" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white">
                                    <option value="basic">Basic Geometry</option>
                                    <option value="advanced">Advanced Calculations</option>
                                    <option value="performance">Performance Metrics</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flight-visualization mb-8">
                            <canvas id="flightCanvas" width="800" height="400"></canvas>
                        </div>
                        
                        <div class="equation-list mb-8" id="equationList">
                            <div class="info-card">
                                <h4><i class="fas fa-brain mr-2"></i> Suggested Mathematical Concepts</h4>
                                <p id="aiSuggestedEquations">Click "Analyze Flight Path" to see which mathematical concepts are most relevant to this flight pattern.</p>
                                <button class="accent-button mt-3" onclick="analyzeFlightPath()">
                                    <i class="fas fa-robot mr-2"></i> Analyze Flight Path
                                </button>
                            </div>
                        </div>
                        
                        <!-- Vertical Info Blocks -->
                        <div class="info-vertical mb-8">
                            <div class="info-card">
                                <h4><i class="fas fa-history mr-2"></i> Historical Context</h4>
                                <p id="origin">After analyzing the flight path, we'll show the historical development of the relevant mathematical concepts.</p>
                            </div>
                            
                            <div class="info-card">
                                <h4><i class="fas fa-rocket mr-2"></i> Modern Applications</h4>
                                <p id="modernUse">Discover how these mathematical concepts are applied in modern technology, especially in drone aviation.</p>
                            </div>
                            
                            <div class="info-card">
                                <h4><i class="fas fa-drone mr-2"></i> Drone Technology</h4>
                                <p id="droneImpact">Learn how these equations impact drone flight paths, navigation, and performance optimization.</p>
                            </div>
                            
                            <div class="info-card">
                                <h4><i class="fas fa-code mr-2"></i> Programming</h4>
                                <p id="coding">See practical examples of how to implement these mathematical concepts in programming code.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="learning-section">
                        <div class="problem-container mb-6">
                            <h3><i class="fas fa-puzzle-piece mr-2"></i> Learning Challenge</h3>
                            <div class="problem-content" id="problemArea">
                                <p>After analyzing the flight path, we'll generate a customized problem based on the mathematical concepts involved.</p>
                            </div>
                            
                            <div class="answer-input mt-4">
                                <textarea id="studentAnswer" placeholder="Type your solution here... Be sure to show your work and explain your reasoning."></textarea>
                                <button class="accent-button mt-4" onclick="checkAnswer()"><i class="fas fa-paper-plane mr-2"></i> Submit Answer</button>
                                <button class="accent-button mt-4 ml-3" onclick="simplifyAnswer()" style="background: var(--accent);">
                                    <i class="fas fa-comment-alt mr-2"></i> Simplify Explanation
                                </button>
                                <button class="accent-button mt-4 ml-3" onclick="translateToHindi()" style="background: #FF9500;">
                                    <i class="fas fa-language mr-2"></i> Hindi Explanation
                                </button>
                            </div>
                        </div>
                        
                        <div class="feedback-container mb-6" id="feedbackContainer" style="display: none;">
                            <div class="flex items-center mb-4">
                                <h3 class="text-xl font-semibold text-white"><i class="fas fa-comment-dots mr-2"></i> Feedback</h3>
                                <span class="badge bg-purple-500 text-white px-3 py-1 rounded-full ml-3 text-sm" id="feedbackBadge">New</span>
                            </div>
                            <div class="feedback-content" id="feedbackArea"></div>
                        </div>
                        
                        <div class="progress-container bg-gray-800 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="text-sm font-medium text-gray-300"><i class="fas fa-trophy mr-2"></i> Mastery Progress</h4>
                                <span id="masteryPercent" class="text-sm font-bold text-purple-400">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="masteryProgress"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-400 mt-2">
                                <span id="attemptsCount">Attempts: 0</span>
                                <span id="timeSpent">Time: 0s</span>
                                <span id="accuracyRate">Accuracy: 0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profile" class="content-section py-8" style="display: none;">
            <h2 class="text-2xl font-bold section-heading mb-6"><i class="fas fa-user mr-2"></i> My Profile</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="connect-form">
                        <h3 class="text-xl font-semibold mb-4">Personal Information</h3>
                        <div class="mb-4">
                            <label for="profileName" class="block text-sm font-medium text-gray-300 mb-2">Full Name</label>
                            <input type="text" id="profileName" placeholder="Enter your full name" class="w-full">
                        </div>
                        <div class="mb-4">
                            <label for="profileEmail" class="block text-sm font-medium text-gray-300 mb-2">Email Address</label>
                            <input type="email" id="profileEmail" placeholder="Enter your email" class="w-full">
                        </div>
                        <div class="mb-4">
                            <label for="profileCollege" class="block text-sm font-medium text-gray-300 mb-2">School/College</label>
                            <input type="text" id="profileCollege" placeholder="Enter your school/college name" class="w-full">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="profileGrade" class="block text-sm font-medium text-gray-300 mb-2">Grade/Class</label>
                                <select id="profileGrade" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white">
                                    <option value="">-- Select Grade --</option>
                                    <option value="6">Grade 6</option>
                                    <option value="7">Grade 7</option>
                                    <option value="8">Grade 8</option>
                                    <option value="9">Grade 9</option>
                                    <option value="10">Grade 10</option>
                                    <option value="11">Grade 11</option>
                                    <option value="12">Grade 12</option>
                                </select>
                            </div>
                            <div>
                                <label for="profileAge" class="block text-sm font-medium text-gray-300 mb-2">Age</label>
                                <input type="number" id="profileAge" placeholder="Enter your age" class="w-full">
                            </div>
                        </div>
                        <button class="accent-button w-full mt-6" onclick="saveProfile()">
                            <i class="fas fa-save mr-2"></i> Save Profile
                        </button>
                        <div id="profileStatus" class="mt-4 p-3 rounded-lg text-center hidden">
                            <p id="profileStatusText"></p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="info-card h-full">
                        <h4><i class="fas fa-info-circle mr-2"></i> Profile Information</h4>
                        <p class="mb-3">Your profile helps us customize the learning experience to your grade level and interests.</p>
                        <p class="mb-3">We'll use this information to:</p>
                        <ul class="list-disc list-inside mb-3 pl-2">
                            <li>Suggest appropriate challenges</li>
                            <li>Track your progress</li>
                            <li>Personalize your certificates</li>
                            <li>Recommend competitions</li>
                        </ul>
                        <p class="text-sm text-gray-400 mt-4">Note: All information is kept secure and private.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Competitions Section -->
        <section id="competitions" class="content-section py-8" style="display: none;">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <div class="lg:col-span-3">
                    <h2 class="text-2xl font-bold section-heading mb-6"><i class="fas fa-trophy mr-2"></i> Current Competitions</h2>
                    
                    <div id="competitionsList">
                        <!-- Competitions will be loaded here by AI -->
                        <div class="competition-card">
                            <h4><i class="fas fa-spinner fa-spin mr-2"></i> Loading Competitions...</h4>
                            <p>Please wait while we load the latest competitions</p>
                        </div>
                    </div>
                </div>
                
                <div class="lg:col-span-1">
                    <div class="sidebar">
                        <h3 class="text-lg font-semibold mb-4 text-white border-b border-gray-700 pb-2">Competition Updates</h3>
                        <div id="competitionUpdates">
                            <p><i class="fas fa-spinner fa-spin mr-2"></i> Loading updates...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Piloting Section -->
        <section id="pilot" class="content-section py-8" style="display: none;">
            <h2 class="text-2xl font-bold section-heading mb-6"><i class="fas fa-drone mr-2"></i> Drone Piloting Controls</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="card">
                        <h3 class="text-xl font-semibold mb-4"><i class="fas fa-gamepad mr-2"></i> Manual Controls</h3>
                        
                        <div class="drone-controls">
                            <div class="control-btn" onclick="sendDroneCommand('takeoff')">
                                <i class="fas fa-rocket"></i>
                                <span>Takeoff</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('land')">
                                <i class="fas fa-landmark"></i>
                                <span>Land</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('emergency')">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Emergency Stop</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('forward')">
                                <i class="fas fa-arrow-up"></i>
                                <span>Forward</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('backward')">
                                <i class="fas fa-arrow-down"></i>
                                <span>Backward</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('left')">
                                <i class="fas fa-arrow-left"></i>
                                <span>Left</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('right')">
                                <i class="fas fa-arrow-right"></i>
                                <span>Right</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('up')">
                                <i class="fas fa-arrow-alt-circle-up"></i>
                                <span>Up</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('down')">
                                <i class="fas fa-arrow-alt-circle-down"></i>
                                <span>Down</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('rotate_left')">
                                <i class="fas fa-undo"></i>
                                <span>Rotate Left</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('rotate_right')">
                                <i class="fas fa-redo"></i>
                                <span>Rotate Right</span>
                            </div>
                            <div class="control-btn" onclick="sendDroneCommand('hover')">
                                <i class="fas fa-pause"></i>
                                <span>Hover</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="lg:col-span-1">
                    <div class="card">
                        <h3 class="text-xl font-semibold mb-4"><i class="fas fa-robot mr-2"></i> AI Assistant</h3>
                        <div class="problem-content mb-4">
                            <p>Ask the AI for help with piloting or flight planning:</p>
                        </div>
                        <textarea id="pilotQuestion" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white mb-4" placeholder="Type your piloting question here..."></textarea>
                        <button class="accent-button w-full" onclick="askPilotQuestion()">
                            <i class="fas fa-question-circle mr-2"></i> Ask AI
                        </button>
                        <div id="pilotAnswer" class="mt-4 p-4 bg-gray-800 rounded-lg" style="display: none;">
                            <h4 class="text-lg font-semibold mb-2">AI Response:</h4>
                            <p id="pilotAnswerText"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Certificates Section -->
        <section id="certificates" class="content-section py-8" style="display: none;">
            <h2 class="text-2xl font-bold section-heading mb-6"><i class="fas fa-certificate mr-2"></i> My Certificates</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="info-card">
                    <h4><i class="fas fa-certificate mr-2"></i> Drone Math Basics</h4>
                    <p>Completed on: July 15, 2024</p>
                    <button class="accent-button mt-3" onclick="viewCertificate('Drone Math Basics')">
                        <i class="fas fa-eye mr-2"></i> View Certificate
                    </button>
                </div>
                
                <div class="info-card">
                    <h4><i class="fas fa-certificate mr-2"></i> Advanced Flight Calculations</h4>
                    <p>Completed on: June 28, 2024</p>
                    <button class="accent-button mt-3" onclick="viewCertificate('Advanced Flight Calculations')">
                        <i class="fas fa-eye mr-2"></i> View Certificate
                    </button>
                </div>
                
                <div class="info-card">
                    <h4><i class="fas fa-certificate mr-2"></i> Drone Programming</h4>
                    <p>Completed on: June 10, 2024</p>
                    <button class="accent-button mt-3" onclick="viewCertificate('Drone Programming')">
                        <i class="fas fa-eye mr-2"></i> View Certificate
                    </button>
                </div>
            </div>
        </section>

        <!-- Connect Drone Section -->
        <section id="connect" class="content-section py-8" style="display: none;">
            <h2 class="text-2xl font-bold section-heading mb-6"><i class="fas fa-link mr-2"></i> Connect Your Drone</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="connect-form">
                    <h3 class="text-xl font-semibold mb-4">Drone Connection</h3>
                    <div class="mb-4">
                        <label for="droneIp" class="block text-sm font-medium text-gray-300 mb-2">Drone IP Address</label>
                        <input type="text" id="droneIp" placeholder="Enter drone IP address (e.g., 192.168.1.1)" class="w-full">
                    </div>
                    <div class="mb-4">
                        <label for="dronePort" class="block text-sm font-medium text-gray-300 mb-2">Port</label>
                        <input type="text" id="dronePort" placeholder="Enter port number (default: 8888)" class="w-full" value="8888">
                    </div>
                    <div class="mb-4">
                        <label for="dronePassword" class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                        <input type="password" id="dronePassword" placeholder="Enter drone password" class="w-full">
                    </div>
                    <button class="accent-button w-full" onclick="connectToDrone()">
                        <i class="fas fa-plug mr-2"></i> Connect to Drone
                    </button>
                    <div id="connectionStatus" class="mt-4 p-3 rounded-lg text-center hidden">
                        <p id="statusText"></p>
                    </div>
                </div>
                
                <div>
                    <div class="info-card h-full">
                        <h4><i class="fas fa-info-circle mr-2"></i> Connection Instructions</h4>
                        <p class="mb-3">1. Ensure your drone is powered on and in pairing mode</p>
                        <p class="mb-3">2. Connect your device to the drone's WiFi network</p>
                        <p class="mb-3">3. Enter the IP address and password provided with your drone</p>
                        <p class="mb-3">4. Click "Connect to Drone" to establish connection</p>
                        <p class="text-sm text-gray-400 mt-4">Note: For security reasons, always change the default password after first connection.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Global variables
        let currentLanguage = 'english';
        let currentGradeLevel = '';
        let droneConnected = false;
        let masteryProgress = 0;
        let attemptsCount = 0;
        let startTime = new Date();
        let correctAnswers = 0;
        let selectedEquation = '';
        let currentProblem = '';
        let currentSolution = '';
        const MISTRAL_API_KEY = 'x4FTLzA5S3mjqJX42QYspPDuOfrLGpTJ';
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Set up navigation
            setupNavigation();
            
            // Initialize canvas animations
            initDroneCanvas();
            initFlightCanvas();
            
            // Load profile if exists
            loadProfile();
            
            // Set default grade level to 8
            document.getElementById('classSelect').value = '8';
            currentGradeLevel = '8';
            
            // Start timer for time spent calculation
            setInterval(updateTimeSpent, 1000);
        });
        
        // Navigation setup
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link, .sidebar-menu a');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Hide all sections
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    // Show selected section
                    const targetId = this.getAttribute('href').substring(1);
                    document.getElementById(targetId).style.display = 'block';
                    
                    // Update active link
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Special handling for competitions section
                    if (targetId === 'competitions') {
                        loadCompetitions();
                    }
                });
            });
        }
        
        // Initialize drone background canvas
        function initDroneCanvas() {
            const canvas = document.getElementById('droneCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas to full window size
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Drone particles
            const drones = [];
            const droneCount = 15;
            
            // Create drones
            for (let i = 0; i < droneCount; i++) {
                drones.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 3 + 2,
                    speedX: Math.random() * 2 - 1,
                    speedY: Math.random() * 2 - 1,
                    color: `hsl(${Math.random() * 60 + 200}, 80%, 60%)`,
                    trail: []
                });
            }
            
            // Animation loop
            function animate() {
                ctx.fillStyle = 'rgba(10, 10, 10, 0.2)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                drones.forEach(drone => {
                    // Update position
                    drone.x += drone.speedX;
                    drone.y += drone.speedY;
                    
                    // Bounce off edges
                    if (drone.x < 0 || drone.x > canvas.width) drone.speedX *= -1;
                    if (drone.y < 0 || drone.y > canvas.height) drone.speedY *= -1;
                    
                    // Add current position to trail
                    drone.trail.push({x: drone.x, y: drone.y});
                    if (drone.trail.length > 20) drone.trail.shift();
                    
                    // Draw trail
                    ctx.strokeStyle = drone.color;
                    ctx.lineWidth = drone.size / 2;
                    ctx.beginPath();
                    ctx.moveTo(drone.trail[0].x, drone.trail[0].y);
                    for (let i = 1; i < drone.trail.length; i++) {
                        ctx.lineTo(drone.trail[i].x, drone.trail[i].y);
                    }
                    ctx.stroke();
                    
                    // Draw drone
                    ctx.fillStyle = drone.color;
                    ctx.beginPath();
                    ctx.arc(drone.x, drone.y, drone.size, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
            
            // Handle window resize
            window.addEventListener('resize', function() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }
        
        // Initialize flight path canvas
        function initFlightCanvas() {
            const canvas = document.getElementById('flightCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas dimensions
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // Flight path data
            const flightPath = generateFlightPath();
            
            // Draw flight path
            function drawFlightPath() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw grid
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                
                // Vertical grid lines
                for (let x = 0; x < canvas.width; x += 50) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, canvas.height);
                    ctx.stroke();
                }
                
                // Horizontal grid lines
                for (let y = 0; y < canvas.height; y += 50) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }
                
                // Draw flight path
                ctx.strokeStyle = '#3B82F6';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(flightPath[0].x, flightPath[0].y);
                
                for (let i = 1; i < flightPath.length; i++) {
                    ctx.lineTo(flightPath[i].x, flightPath[i].y);
                }
                
                ctx.stroke();
                
                // Draw points of interest
                flightPath.forEach((point, index) => {
                    if (point.important) {
                        ctx.fillStyle = '#A855F7';
                        ctx.beginPath();
                        ctx.arc(point.x, point.y, 6, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Draw point label
                        ctx.fillStyle = 'white';
                        ctx.font = '12px Montserrat';
                        ctx.fillText(point.label, point.x + 10, point.y - 10);
                    }
                });
                
                // Draw start and end points
                // Start point
                ctx.fillStyle = '#10B981';
                ctx.beginPath();
                ctx.arc(flightPath[0].x, flightPath[0].y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.font = 'bold 12px Montserrat';
                ctx.fillText('Start', flightPath[0].x + 10, flightPath[0].y + 5);
                
                // End point
                ctx.fillStyle = '#EF4444';
                ctx.beginPath();
                ctx.arc(flightPath[flightPath.length - 1].x, flightPath[flightPath.length - 1].y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.font = 'bold 12px Montserrat';
                ctx.fillText('End', flightPath[flightPath.length - 1].x + 10, flightPath[flightPath.length - 1].y + 5);
            }
            
            // Generate a sample flight path
            function generateFlightPath() {
                const path = [];
                const steps = 20;
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = Math.min(canvas.width, canvas.height) * 0.4;
                
                for (let i = 0; i <= steps; i++) {
                    const angle = (i / steps) * Math.PI * 2;
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius * 0.6;
                    
                    path.push({
                        x: x,
                        y: y,
                        important: i % 5 === 0,
                        label: i % 5 === 0 ? `P${i/5 + 1}` : ''
                    });
                }
                
                return path;
            }
            
            drawFlightPath();
        }
        
        // Analyze flight path and suggest equations
        function analyzeFlightPath() {
            const gradeLevel = document.getElementById('classSelect').value || '8';
            const equationList = document.getElementById('equationList');
            
            // Show loading state
            equationList.innerHTML = `
                <div class="info-card">
                    <h4><i class="fas fa-spinner fa-spin mr-2"></i> Analyzing Flight Path</h4>
                    <p>Our AI is analyzing the flight path to suggest relevant mathematical concepts...</p>
                </div>
            `;
            
            // Call AI to analyze flight path and suggest equations
            callMistralAI(
                `Analyze this drone flight path pattern (circular with waypoints) and suggest 3-5 mathematical concepts 
                that would be most relevant for a grade ${gradeLevel} student to understand and analyze this flight. 
                For each concept, provide:
                1. The name of the mathematical concept
                2. The standard formula/equation
                3. A very brief (1 sentence) explanation of how it applies to this flight path
                
                Format the response as HTML buttons with class="equation-btn" for each concept.`
            ).then(response => {
                equationList.innerHTML = response;
                
                // Add click handlers to the generated buttons
                document.querySelectorAll('.equation-btn').forEach(button => {
                    button.onclick = function() {
                        selectEquationFromAI(this.textContent);
                        
                        // Remove active class from all buttons
                        document.querySelectorAll('.equation-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        
                        // Add active class to clicked button
                        this.classList.add('active');
                    };
                });
            }).catch(error => {
                equationList.innerHTML = `
                    <div class="info-card">
                        <h4><i class="fas fa-exclamation-triangle mr-2"></i> Analysis Failed</h4>
                        <p>Could not analyze flight path. Please try again later.</p>
                        <button class="accent-button mt-3" onclick="analyzeFlightPath()">
                            <i class="fas fa-redo mr-2"></i> Try Again
                        </button>
                    </div>
                `;
                console.error('Error analyzing flight path:', error);
            });
        }
        
        // Handle equation selection from AI analysis
        function selectEquationFromAI(equationText) {
            // Extract equation name from the button text
            const equationParts = equationText.split(':');
            selectedEquation = equationParts[0].trim();
            const formula = equationParts.length > 1 ? equationParts[1].trim() : '';
            
            // Call AI to get detailed information about this equation
            callMistralAI(
                `Provide detailed information about the mathematical concept "${selectedEquation}" (${formula}) for a student. Include:
                1. Historical context (1 paragraph)
                2. Modern applications (1 paragraph)
                3. Drone technology applications (1 paragraph)
                4. Programming implementation example (code snippet)
                
                Format the response as a JSON object with these keys:
                history, modern, drone, code`
            ).then(response => {
                try {
                    const data = JSON.parse(response);
                    document.getElementById('origin').textContent = data.history || 'Historical context not available.';
                    document.getElementById('modernUse').textContent = data.modern || 'Modern applications not available.';
                    document.getElementById('droneImpact').textContent = data.drone || 'Drone applications not available.';
                    document.getElementById('coding').textContent = data.code || 'Code example not available.';
                    
                    // Generate a problem based on this equation
                    generateProblemFromAI(selectedEquation, formula);
                } catch (e) {
                    console.error('Error parsing AI response:', e);
                    // Fallback to generic information
                    document.getElementById('origin').textContent = `The historical development of ${selectedEquation} is fascinating, involving contributions from mathematicians across different cultures and time periods.`;
                    document.getElementById('modernUse').textContent = `${selectedEquation} has numerous applications in modern technology, including drone navigation, computer graphics, and engineering design.`;
                    document.getElementById('droneImpact').textContent = `${selectedEquation} plays a crucial role in drone technology, affecting flight stability, navigation accuracy, and operational efficiency.`;
                    document.getElementById('coding').textContent = `Programming implementation of ${selectedEquation} varies by language but typically involves basic arithmetic operations and sometimes specialized math functions.`;
                    
                    generateProblemFromAI(selectedEquation, formula);
                }
            }).catch(error => {
                console.error('Error getting equation details:', error);
                // Fallback to generic information
                document.getElementById('origin').textContent = `The historical development of ${selectedEquation} is fascinating, involving contributions from mathematicians across different cultures and time periods.`;
                document.getElementById('modernUse').textContent = `${selectedEquation} has numerous applications in modern technology, including drone navigation, computer graphics, and engineering design.`;
                document.getElementById('droneImpact').textContent = `${selectedEquation} plays a crucial role in drone technology, affecting flight stability, navigation accuracy, and operational efficiency.`;
                document.getElementById('coding').textContent = `Programming implementation of ${selectedEquation} varies by language but typically involves basic arithmetic operations and sometimes specialized math functions.`;
                
                generateProblemFromAI(selectedEquation, formula);
            });
        }
        
        // Generate a problem based on the selected equation using AI
        function generateProblemFromAI(equationName, formula) {
            const problemArea = document.getElementById('problemArea');
            const gradeLevel = document.getElementById('classSelect').value || '8';
            
            // Show loading state
            problemArea.innerHTML = '<p><i class="fas fa-spinner fa-spin mr-2"></i> Generating a learning challenge based on ' + equationName + '...</p>';
            
            // Call AI to generate a problem
            callMistralAI(
                `Create a real-world drone-related problem for a grade ${gradeLevel} student that requires using the mathematical concept "${equationName}" (${formula}) to solve it. 
                The problem should:
                1. Be clearly stated
                2. Relate to drone flight or operations
                3. Be appropriate for the grade level
                4. Include all necessary information to solve it
                5. Have a specific numerical answer
                
                Also provide the correct solution with steps and explanation, but keep this separate from the problem statement.
                
                Format the response as a JSON object with these keys:
                problem, solution`
            ).then(response => {
                try {
                    const data = JSON.parse(response);
                    currentProblem = data.problem;
                    currentSolution = data.solution;
                    
                    problemArea.innerHTML = `
                        <p><strong>Problem:</strong> ${currentProblem}</p>
                        <div class="mt-4 p-3 bg-gray-800 rounded-lg border border-gray-700">
                            <p class="text-sm text-purple-300"><i class="fas fa-lightbulb mr-2"></i> <strong>Hint:</strong> Think about how to apply ${equationName} to solve this drone-related problem.</p>
                        </div>
                    `;
                } catch (e) {
                    console.error('Error parsing problem response:', e);
                    problemArea.innerHTML = `
                        <p><strong>Problem:</strong> Create a real-world drone scenario that uses ${equationName} (${formula}) to solve a problem. Explain your solution process.</p>
                        <div class="mt-4 p-3 bg-gray-800 rounded-lg border border-gray-700">
                            <p class="text-sm text-purple-300"><i class="fas fa-lightbulb mr-2"></i> <strong>Hint:</strong> Think about how drones might use ${equationName} in navigation, positioning, or data collection.</p>
                        </div>
                    `;
                }
            }).catch(error => {
                console.error('Error generating problem:', error);
                problemArea.innerHTML = `
                    <p><strong>Problem:</strong> Create a real-world drone scenario that uses ${equationName} (${formula}) to solve a problem. Explain your solution process.</p>
                    <div class="mt-4 p-3 bg-gray-800 rounded-lg border border-gray-700">
                        <p class="text-sm text-purple-300"><i class="fas fa-lightbulb mr-2"></i> <strong>Hint:</strong> Think about how drones might use ${equationName} in navigation, positioning, or data collection.</p>
                    </div>
                `;
            });
        }
        
        // Check student's answer using AI
        function checkAnswer() {
            attemptsCount++;
            const answer = document.getElementById('studentAnswer').value.trim();
            const feedbackArea = document.getElementById('feedbackArea');
            const feedbackContainer = document.getElementById('feedbackContainer');
            
            if (!answer) {
                feedbackArea.innerHTML = '<div class="feedback-incorrect"><i class="fas fa-exclamation-circle mr-2"></i> Please enter your answer before submitting.</div>';
                feedbackContainer.style.display = 'block';
                return;
            }
            
            if (!selectedEquation || !currentProblem) {
                feedbackArea.innerHTML = '<div class="feedback-incorrect"><i class="fas fa-exclamation-circle mr-2"></i> Please select an equation and get a problem first.</div>';
                feedbackContainer.style.display = 'block';
                return;
            }
            
            // Show loading state
            feedbackArea.innerHTML = '<p><i class="fas fa-spinner fa-spin mr-2"></i> Analyzing your answer...</p>';
            feedbackContainer.style.display = 'block';
            
            // Call AI to check the answer
            callMistralAI(
                `Evaluate this student's answer to a math problem about drones. Here are the details:
                
                Mathematical Concept: ${selectedEquation}
                Problem: ${currentProblem}
                Correct Solution: ${currentSolution}
                Student's Answer: ${answer}
                
                Provide evaluation with:
                1. Is the answer correct? (true/false)
                2. Detailed feedback on what's good and what needs improvement
                3. Explanation of the correct solution if needed
                4. Suggestions for improvement
                
                Format the response as a JSON object with these keys:
                correct, feedback, explanation, suggestions`
            ).then(response => {
                try {
                    const data = JSON.parse(response);
                    
                    if (data.correct === true) {
                        correctAnswers++;
                        masteryProgress = Math.min(100, masteryProgress + 15);
                        feedbackArea.innerHTML = `
                            <div class="feedback-correct">
                                <i class="fas fa-check-circle mr-2"></i> <strong>Correct!</strong> ${data.feedback || 'Your solution demonstrates good understanding of ' + selectedEquation}
                                <div class="mt-3 p-2 bg-gray-800 rounded-lg">
                                    <p class="text-sm"><strong>Detailed Feedback:</strong> ${data.suggestions || 'Great job applying this concept correctly!'}</p>
                                </div>
                            </div>
                        `;
                        
                        // Check if mastery is complete
                        if (masteryProgress >= 100) {
                            setTimeout(() => {
                                showCertificate();
                            }, 1500);
                        }
                    } else {
                        masteryProgress = Math.max(0, masteryProgress - 5);
                        feedbackArea.innerHTML = `
                            <div class="feedback-incorrect">
                                <i class="fas fa-times-circle mr-2"></i> <strong>Not quite right.</strong> ${data.feedback || 'There seems to be an issue with your solution.'}
                                <div class="mt-3 p-2 bg-gray-800 rounded-lg">
                                    <p class="text-sm"><strong>Explanation:</strong> ${data.explanation || 'Review the application of ' + selectedEquation}</p>
                                    <p class="text-sm mt-2"><strong>Suggestions:</strong> ${data.suggestions || 'Double-check your calculations and ensure you\'re applying the formula correctly to this specific scenario.'}</p>
                                </div>
                            </div>
                        `;
                    }
                    
                    // Update progress display
                    updateProgressDisplay();
                } catch (e) {
                    console.error('Error parsing evaluation:', e);
                    // Fallback to simple evaluation
                    const isCorrect = answer.includes(currentSolution.split(' ')[0]); // Very basic check
                    
                    if (isCorrect) {
                        correctAnswers++;
                        masteryProgress = Math.min(100, masteryProgress + 15);
                        feedbackArea.innerHTML = `
                            <div class="feedback-correct">
                                <i class="fas fa-check-circle mr-2"></i> <strong>Correct!</strong> Your solution demonstrates good understanding of ${selectedEquation}.
                            </div>
                        `;
                        
                        if (masteryProgress >= 100) {
                            setTimeout(() => {
                                showCertificate();
                            }, 1500);
                        }
                    } else {
                        masteryProgress = Math.max(0, masteryProgress - 5);
                        feedbackArea.innerHTML = `
                            <div class="feedback-incorrect">
                                <i class="fas fa-times-circle mr-2"></i> <strong>Not quite right.</strong> There seems to be an issue with your solution.
                                <div class="mt-3 p-2 bg-gray-800 rounded-lg">
                                    <p class="text-sm"><strong>Correct Solution:</strong> ${currentSolution}</p>
                                </div>
                            </div>
                        `;
                    }
                    
                    updateProgressDisplay();
                }
            }).catch(error => {
                console.error('Error evaluating answer:', error);
                // Fallback to simple evaluation
                const isCorrect = answer.includes(currentSolution.split(' ')[0]); // Very basic check
                
                if (isCorrect) {
                    correctAnswers++;
                    masteryProgress = Math.min(100, masteryProgress + 15);
                    feedbackArea.innerHTML = `
                        <div class="feedback-correct">
                            <i class="fas fa-check-circle mr-2"></i> <strong>Correct!</strong> Your solution demonstrates good understanding of ${selectedEquation}.
                        </div>
                    `;
                    
                    if (masteryProgress >= 100) {
                        setTimeout(() => {
                            showCertificate();
                        }, 1500);
                    }
                } else {
                    masteryProgress = Math.max(0, masteryProgress - 5);
                    feedbackArea.innerHTML = `
                        <div class="feedback-incorrect">
                            <i class="fas fa-times-circle mr-2"></i> <strong>Not quite right.</strong> There seems to be an issue with your solution.
                            <div class="mt-3 p-2 bg-gray-800 rounded-lg">
                                <p class="text-sm"><strong>Correct Solution:</strong> ${currentSolution}</p>
                            </div>
                        </div>
                    `;
                }
                
                updateProgressDisplay();
            });
        }
        
        // Update progress display
        function updateProgressDisplay() {
            document.getElementById('masteryProgress').style.width = `${masteryProgress}%`;
            document.getElementById('masteryPercent').textContent = `${masteryProgress}%`;
            document.getElementById('attemptsCount').textContent = `Attempts: ${attemptsCount}`;
            document.getElementById('accuracyRate').textContent = `Accuracy: ${Math.round((correctAnswers / attemptsCount) * 100)}%`;
        }
        
        // Update time spent display
        function updateTimeSpent() {
            const now = new Date();
            const seconds = Math.floor((now - startTime) / 1000);
            const minutes = Math.floor(seconds / 60);
            const displaySeconds = seconds % 60;
            document.getElementById('timeSpent').textContent = `Time: ${minutes}m ${displaySeconds}s`;
        }
        
        // Show certificate
        function showCertificate() {
            const certificateContainer = document.getElementById('certificateContainer');
            const studentName = document.getElementById('profileName').value || "Student";
            const today = new Date();
            const dateStr = today.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            
            document.getElementById('studentName').textContent = studentName;
            document.getElementById('certificateEquation').textContent = selectedEquation;
            document.getElementById('certificateDate').textContent = dateStr;
            
            certificateContainer.style.display = 'flex';
        }
        
        // Close certificate
        function closeCertificate() {
            document.getElementById('certificateContainer').style.display = 'none';
        }
        
        // Download certificate as PDF
        function downloadCertificate() {
            const element = document.getElementById('certificate');
            const opt = {
                margin: 10,
                filename: `ENIGMA_STEM_ENGINE_Certificate_${selectedEquation.replace(/ /g, '_')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save();
        }
        
        // Toggle language between English and Hindi
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'english' ? 'hindi' : 'english';
            const button = document.getElementById('languageToggle');
            
            if (currentLanguage === 'hindi') {
                button.innerHTML = '<i class="fas fa-language mr-2"></i> English';
                translateToHindi(true);
            } else {
                button.innerHTML = '<i class="fas fa-language mr-2"></i> हिंदी (Hindi)';
                // In a real app, we would translate back to English here
                // For demo, we'll just reload the content in English
                if (selectedEquation) {
                    selectEquationFromAI(selectedEquation);
                }
            }
        }
        
        // Simplify the explanation using AI
        function simplifyAnswer() {
            const answer = document.getElementById('studentAnswer').value.trim();
            
            if (!answer) {
                alert('Please enter your answer first.');
                return;
            }
            
            const gradeLevel = document.getElementById('classSelect').value || '8';
            
            // Show loading state
            const feedbackArea = document.getElementById('feedbackArea');
            feedbackArea.innerHTML = '<p><i class="fas fa-spinner fa-spin mr-2"></i> Simplifying explanation for grade ' + gradeLevel + ' level...</p>';
            document.getElementById('feedbackContainer').style.display = 'block';
            
            // Call Mistral AI API to simplify the explanation
            callMistralAI(
                `Simplify this mathematical explanation for a grade ${gradeLevel} student, keeping the core concepts accurate but using simpler language and more relatable examples. Here's the original explanation:\n\n${answer}`
            ).then(response => {
                feedbackArea.innerHTML = `
                    <div class="feedback-correct">
                        <i class="fas fa-comment-alt mr-2"></i> <strong>Simplified Explanation:</strong>
                        <div class="mt-3 p-3 bg-gray-800 rounded-lg">
                            <p>${response}</p>
                        </div>
                    </div>
                `;
            }).catch(error => {
                feedbackArea.innerHTML = `
                    <div class="feedback-incorrect">
                        <i class="fas fa-exclamation-circle mr-2"></i> Error simplifying explanation. Please try again later.
                    </div>
                `;
                console.error('Error calling Mistral AI:', error);
            });
        }
        
        // Translate answer to Hindi using AI
        function translateToHindi(fullPage = false) {
            let textToTranslate = '';
            
            if (fullPage) {
                // Translate the entire page content
                textToTranslate = `Translate this STEM learning content to Hindi while keeping all technical terms accurate:
                
                Selected Concept: ${selectedEquation}
                Problem: ${currentProblem}
                Current Explanation: ${document.getElementById('studentAnswer').value || 'No answer yet'}
                
                Please provide the Hindi translation for all of this content.`;
            } else {
                const answer = document.getElementById('studentAnswer').value.trim();
                
                if (!answer) {
                    alert('Please enter your answer first.');
                    return;
                }
                
                textToTranslate = answer;
            }
            
            // Show loading state
            const feedbackArea = document.getElementById('feedbackArea');
            feedbackArea.innerHTML = '<p><i class="fas fa-spinner fa-spin mr-2"></i> Translating to Hindi...</p>';
            document.getElementById('feedbackContainer').style.display = 'block';
            
            // Call Mistral AI API to translate to Hindi
            callMistralAI(
                `Translate this STEM/mathematical content to Hindi while keeping all technical terms accurate. Here's the original English text:\n\n${textToTranslate}`
            ).then(response => {
                if (fullPage) {
                    // For demo purposes, we'll just show the translation in the feedback area
                    // In a real app, we would update the entire page content
                    feedbackArea.innerHTML = `
                        <div class="feedback-correct">
                            <i class="fas fa-language mr-2"></i> <strong>Hindi Translation:</strong>
                            <div class="mt-3 p-3 bg-gray-800 rounded-lg">
                                <p>${response}</p>
                                <p class="text-sm text-gray-400 mt-2">Note: In the full application, all content would be translated to Hindi.</p>
                            </div>
                        </div>
                    `;
                } else {
                    feedbackArea.innerHTML = `
                        <div class="feedback-correct">
                            <i class="fas fa-language mr-2"></i> <strong>Hindi Translation:</strong>
                            <div class="mt-3 p-3 bg-gray-800 rounded-lg">
                                <p>${response}</p>
                            </div>
                        </div>
                    `;
                }
            }).catch(error => {
                feedbackArea.innerHTML = `
                    <div class="feedback-incorrect">
                        <i class="fas fa-exclamation-circle mr-2"></i> Error translating to Hindi. Please try again later.
                    </div>
                `;
                console.error('Error calling Mistral AI:', error);
            });
        }
        
        // Load competitions from AI
        function loadCompetitions() {
            const competitionsList = document.getElementById('competitionsList');
            const updatesList = document.getElementById('competitionUpdates');
            
            // Show loading state
            competitionsList.innerHTML = `
                <div class="competition-card">
                    <h4><i class="fas fa-spinner fa-spin mr-2"></i> Loading Competitions...</h4>
                    <p>Please wait while we load the latest competitions</p>
                </div>
            `;
            
            updatesList.innerHTML = '<p><i class="fas fa-spinner fa-spin mr-2"></i> Loading updates...</p>';
            
            // Call Mistral AI API to generate competitions
            callMistralAI(
                `Generate 3 STEM drone competitions for high school students with creative challenges that involve math, programming, and drone piloting skills. 
                For each competition, provide:
                1. A creative title
                2. A 1-2 sentence description of the challenge
                3. The key skills tested
                4. The deadline date (random future dates in the next 3 months)
                
                Format the response as HTML div elements with class="competition-card" for each competition.`
            ).then(response => {
                competitionsList.innerHTML = response;
                
                // Now generate updates
                return callMistralAI(
                    `Generate 5 recent updates about the drone competitions you just created. These should include:
                    1. Registration numbers increasing
                    2. New teams joining
                    3. Preparation tips
                    4. Rule clarifications
                    5. Exciting developments
                    
                    Format each update as a short paragraph with an emoji at the start.`
                );
            }).then(updates => {
                updatesList.innerHTML = updates;
            }).catch(error => {
                competitionsList.innerHTML = `
                    <div class="competition-card">
                        <h4><i class="fas fa-exclamation-triangle mr-2"></i> Error Loading Competitions</h4>
                        <p>Could not load competitions. Please try again later.</p>
                    </div>
                `;
                updatesList.innerHTML = '<p><i class="fas fa-exclamation-triangle mr-2"></i> Could not load updates</p>';
                console.error('Error loading competitions:', error);
            });
        }
        
        // Ask pilot question to AI
        function askPilotQuestion() {
            const question = document.getElementById('pilotQuestion').value.trim();
            const pilotAnswer = document.getElementById('pilotAnswer');
            const pilotAnswerText = document.getElementById('pilotAnswerText');
            
            if (!question) {
                alert('Please enter your piloting question first.');
                return;
            }
            
            // Show loading state
            pilotAnswerText.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Analyzing your question...';
            pilotAnswer.style.display = 'block';
            
            // Call Mistral AI API
            callMistralAI(
                `You are a drone piloting expert. Answer this question in simple terms suitable for a student: ${question}
                
                Include:
                1. A clear, concise answer
                2. Any important safety considerations
                3. Practical tips if applicable
                4. Common mistakes to avoid`
            ).then(response => {
                pilotAnswerText.innerHTML = response;
            }).catch(error => {
                pilotAnswerText.innerHTML = 'Sorry, I encountered an error answering your question. Please try again later.';
                console.error('Error calling Mistral AI:', error);
            });
        }
        
        // Connect to drone
        function connectToDrone() {
            const ip = document.getElementById('droneIp').value.trim();
            const port = document.getElementById('dronePort').value.trim();
            const password = document.getElementById('dronePassword').value;
            const statusDiv = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            if (!ip || !password) {
                statusDiv.className = 'bg-red-900 text-red-100';
                statusText.textContent = 'Please enter both IP address and password';
                statusDiv.classList.remove('hidden');
                return;
            }
            
            // Simulate connection (in a real app, this would actually connect)
            statusDiv.className = 'bg-blue-900 text-blue-100';
            statusText.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Connecting to drone at ' + ip + '...';
            statusDiv.classList.remove('hidden');
            
            setTimeout(() => {
                // Simulate successful connection
                droneConnected = true;
                statusDiv.className = 'bg-green-900 text-green-100';
                statusText.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Successfully connected to drone!';
                
                // Enable piloting section
                document.querySelector('a[href="#pilot"]').classList.remove('disabled');
            }, 2000);
        }
        
        // Send drone command
        function sendDroneCommand(command) {
            if (!droneConnected) {
                alert('Please connect to a drone first.');
                return;
            }
            
            // In a real app, this would send the command to the drone
            console.log('Sending command to drone:', command);
            
            // Show visual feedback
            const statusDiv = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            statusDiv.className = 'bg-purple-900 text-purple-100';
            statusText.innerHTML = `<i class="fas fa-paper-plane mr-2"></i> Sent command: ${command}`;
            statusDiv.classList.remove('hidden');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 2000);
        }
        
        // View certificate
        function viewCertificate(certName) {
            document.getElementById('certificateEquation').textContent = certName;
            showCertificate();
        }
        
        // Save profile
        function saveProfile() {
            const name = document.getElementById('profileName').value.trim();
            const email = document.getElementById('profileEmail').value.trim();
            const college = document.getElementById('profileCollege').value.trim();
            const grade = document.getElementById('profileGrade').value;
            const age = document.getElementById('profileAge').value;
            
            if (!name || !email || !college || !grade || !age) {
                document.getElementById('profileStatus').className = 'bg-red-900 text-red-100';
                document.getElementById('profileStatusText').textContent = 'Please fill all fields';
                document.getElementById('profileStatus').classList.remove('hidden');
                return;
            }
            
            // Save to localStorage
            const profile = {
                name: name,
                email: email,
                college: college,
                grade: grade,
                age: age
            };
            
            localStorage.setItem('droneProfile', JSON.stringify(profile));
            
            // Update UI
            document.getElementById('profileStatus').className = 'bg-green-900 text-green-100';
            document.getElementById('profileStatusText').textContent = 'Profile saved successfully!';
            document.getElementById('profileStatus').classList.remove('hidden');
            
            // Update class select in main section
            document.getElementById('classSelect').value = grade;
            currentGradeLevel = grade;
            
            setTimeout(() => {
                document.getElementById('profileStatus').classList.add('hidden');
            }, 3000);
        }
        
        // Load profile
        function loadProfile() {
            const profile = JSON.parse(localStorage.getItem('droneProfile'));
            
            if (profile) {
                document.getElementById('profileName').value = profile.name || '';
                document.getElementById('profileEmail').value = profile.email || '';
                document.getElementById('profileCollege').value = profile.college || '';
                document.getElementById('profileGrade').value = profile.grade || '';
                document.getElementById('profileAge').value = profile.age || '';
                
                // Update class select in main section
                document.getElementById('classSelect').value = profile.grade || '8';
                currentGradeLevel = profile.grade || '8';
            }
        }
        
        // Call Mistral AI API
        async function callMistralAI(prompt) {
            try {
                const response = await fetch("https://api.mistral.ai/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': `Bearer ${MISTRAL_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "mistral-large-latest",
                        messages: [{"role": "user", "content": prompt}],
                        temperature: 0.7
                    })
                });
                
                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Error calling Mistral AI:', error);
                throw error;
            }
        }
    </script>
</body>
</html>
